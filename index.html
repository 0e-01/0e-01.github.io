<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åè¬å¹´å‰ï¼šæ´ç©´å†’éšªæœ€çµ‚ç‰ˆ</title>
    <style>
        body {
            background: radial-gradient(circle, #4e3b2c 0%, #1a120b 100%);
            margin: 0; height: 100vh; display: flex; justify-content: center; align-items: center;
            font-family: "Microsoft JhengHei", sans-serif; color: #f4e4bc; overflow: hidden;
        }
        #game-container {
            background: rgba(0, 0, 0, 0.6); padding: 30px; border-radius: 20px; border: 4px solid #8b7355;
            display: flex; flex-direction: row; gap: 30px; max-width: 1000px; width: 95%;
        }
        .canvas-section { flex: 1.2; position: relative; }
        canvas {
            background: #e6d5b8; border: 8px solid #3d2b1f; border-radius: 10px;
            cursor: crosshair; display: block; width: 100%; height: auto; touch-action: none;
            background-image: url('https://www.transparenttextures.com/patterns/pinstriped-suit.png');
        }
        .info-section { flex: 0.8; display: flex; flex-direction: column; justify-content: space-between; }
        h1 { margin: 0; color: #ffa500; font-size: 1.8em; text-shadow: 2px 2px #000; }
        
        /* å·¥å…·ç®±æ¨£å¼ */
        .toolbar {
            display: flex; gap: 10px; margin: 10px 0; padding: 10px;
            background: rgba(255,255,255,0.1); border-radius: 8px; align-items: center;
        }
        .color-btn { width: 30px; height: 30px; border-radius: 50%; border: 2px solid #fff; cursor: pointer; transition: 0.2s; }
        .color-btn:hover { transform: scale(1.2); }
        .color-btn.active { border: 3px solid #ffa500; transform: scale(1.1); }
        .eraser-btn { padding: 5px 10px; background: #eee; color: #333; border-radius: 5px; cursor: pointer; font-size: 0.8em; font-weight: bold; }

        #event-display {
            background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 10px;
            border-left: 5px solid #ffa500; font-size: 1em; min-height: 180px; line-height: 1.5;
        }
        .controls { display: flex; gap: 10px; margin-top: 15px; }
        .btn { flex: 1; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .btn-primary { background: #d2691e; color: white; }
        .btn-secondary { background: #555; color: #eee; }
        @media (max-width: 800px) { #game-container { flex-direction: column; overflow-y: auto; } }
    </style>
</head>
<body>

    <div id="game-container">
        <div class="canvas-section">
            <canvas id="paintCanvas" width="500" height="500"></canvas>
        </div>

        <div class="info-section">
            <header>
                <h1 id="title">ğŸ¦´ æ´ç©´æ‰‹è¨˜</h1>
                <p id="progress-tag" style="margin:5px 0;">é€²åº¦ï¼šå¬å–šè‹±é›„</p>
            </header>

            <div class="toolbar">
                <span>ç•«ç­†ï¼š</span>
                <div class="color-btn active" style="background: #2b1d12;" onclick="setBrush('#2b1d12', 5, this)"></div>
                <div class="color-btn" style="background: #d32f2f;" onclick="setBrush('#d32f2f', 5, this)"></div>
                <div class="color-btn" style="background: #1976d2;" onclick="setBrush('#1976d2', 5, this)"></div>
                <div class="color-btn" style="background: #388e3c;" onclick="setBrush('#388e3c', 5, this)"></div>
                <div class="eraser-btn" onclick="setBrush('#e6d5b8', 20, this)">æ©¡çš®æ“¦</div>
            </div>
            
            <div id="event-display">
                <p id="event-text">ã€åºç« ã€‘<br>ä½ ç©¿è¶Šåˆ°äº†åè¬å¹´å‰çš„å±±æ´...<br><br><strong>è«‹å…ˆç•«å‡ºä½ çš„ã€Œç«æŸ´äººè‹±é›„ã€ã€‚</strong><br>(å»ºè­°ä½¿ç”¨é»‘è‰²ï¼Œç•«å®Œä»–å°‡é™ªä¼´ä½ å…¨ç¨‹ï¼)</p>
            </div>

            <div class="controls">
                <button class="btn btn-secondary" onclick="clearCurrentOnly()">å›é€€æœ¬é—œ</button>
                <button class="btn btn-primary" id="actionBtn" onclick="handleAction()">æˆ‘ç•«å¥½äº†</button>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('paintCanvas');
        const ctx = canvas.getContext('2d');
        const eventText = document.getElementById('event-text');
        const actionBtn = document.getElementById('actionBtn');
        const progressTag = document.getElementById('progress-tag');

        let painting = false;
        let step = 0; 
        let currentSize = 5;
        let currentColor = '#2b1d12';
        
        const saveCanvas = document.createElement('canvas');
        saveCanvas.width = 500; saveCanvas.height = 500;
        const saveCtx = saveCanvas.getContext('2d');

        const adventureList = [
            { q: "ã€ç¬¬ä¸€é—œã€‘", t: "ä¸€é ­çŒ›ç‘ªè±¡è¡éä¾†äº†ï¼", a: "åœ¨è‹±é›„èº«é‚Šç•«å‡ºã€é•·çŸ›ã€‘æˆ–ã€é™·é˜±ã€‘ï¼" },
            { q: "ã€ç¬¬äºŒé—œã€‘", t: "å¤©é»‘äº†ï¼Œç‹¼ç¾¤åœ¨é è¿‘...", a: "ç•«å‡ºç´…è‰²çš„ã€ç«å †ã€‘é©…è¶•ç‰ å€‘ï¼" },
            { q: "ã€ç¬¬ä¸‰é—œã€‘", t: "å‰æ–¹å‡ºç¾ç™¾ç±³æ·±çš„å¤§è£‚è°·ï¼", a: "ç•«å‡ºã€ç¿…è†€ã€‘æˆ–ã€é•·æ©‹ã€‘é€šéå§ï¼" },
            { q: "ã€ç¬¬å››é—œã€‘", t: "åŸå§‹äººéƒ¨è½æƒ³çœ‹ä½ çš„å¯¶ç‰©...", a: "ç•«å‡ºä½ å¾ç¾ä»£å¸¶ä¾†çš„ã€ç¥å¥‡ç‰©å“ã€‘ï¼" },
            { q: "ã€æœ€çµ‚é—œã€‘", t: "æ™‚ç©ºè£‚ç¸«å‡ºç¾äº†ï¼", a: "å¿«ç•«å‡ºã€æ™‚å…‰æ©Ÿã€‘æˆ–æ˜¯ã€å‚³é€é–€ã€‘å›å®¶ï¼" }
        ];

        // åˆ‡æ›ç•«ç­†èˆ‡é¡è‰²
        function setBrush(color, size, el) {
            currentColor = color;
            currentSize = size;
            document.querySelectorAll('.color-btn, .eraser-btn').forEach(btn => btn.classList.remove('active'));
            el.classList.add('active');
        }

        function getPos(e) {
            const rect = canvas.getBoundingClientRect();
            let cx = e.touches ? e.touches[0].clientX : e.clientX;
            let cy = e.touches ? e.touches[0].clientY : e.clientY;
            return {
                x: (cx - rect.left) * (canvas.width / rect.width),
                y: (cy - rect.top) * (canvas.height / rect.height)
            };
        }

        function startPosition(e) { painting = true; draw(e); }
        function finishedPosition() { painting = false; ctx.beginPath(); }
        
        function draw(e) {
            if (!painting) return;
            e.preventDefault();
            const pos = getPos(e);
            ctx.lineWidth = currentSize;
            ctx.lineCap = 'round';
            ctx.strokeStyle = currentColor;
            ctx.lineTo(pos.x, pos.y);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(pos.x, pos.y);
        }

        canvas.addEventListener('mousedown', startPosition);
        canvas.addEventListener('mousemove', draw);
        window.addEventListener('mouseup', finishedPosition);
        canvas.addEventListener('touchstart', startPosition);
        canvas.addEventListener('touchmove', draw);
        canvas.addEventListener('touchend', finishedPosition);

        function clearCurrentOnly() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(saveCanvas, 0, 0);
        }

        function handleAction() {
            saveCtx.clearRect(0, 0, 500, 500);
            saveCtx.drawImage(canvas, 0, 0);

            if (step < 5) {
                const ev = adventureList[step];
                progressTag.innerText = `å†’éšªé€²åº¦ï¼š${step + 1} / 5`;
                eventText.innerHTML = `<b style="color:#ffa500; font-size:1.1em;">${ev.q} ${ev.t}</b><br><br>${ev.a}`;
                actionBtn.innerText = (step === 4) ? "ç™¼å‹•æ™‚å…‰æ©Ÿï¼" : "ä¸‹ä¸€é—œ";
                step++;
            } else {
                showEnding();
            }
        }

        function showEnding() {
            progressTag.innerText = "çµå±€ï¼šå›åˆ°ç¾ä»£";
            document.querySelector('.toolbar').style.visibility = "hidden";
            eventText.innerHTML = `
                <b style="color:#00ff00; font-size:1.3em;">ğŸŒ€ ç©¿è¶ŠæˆåŠŸï¼</b><br><br>
                ä½ å¸¶è‘—æ»¿æ»¿çš„ã€Œæˆ°åˆ©å“ã€å›åˆ°äº†ç¾ä»£ã€‚<br><br>
                é€™å¹…å£ç•«è­‰æ˜äº†ä½ åœ¨åè¬å¹´å‰çš„å‚³å¥‡å†’éšªï¼
            `;
            actionBtn.innerText = "é‡å•Ÿå†’éšª";
            actionBtn.onclick = () => location.reload();
            document.querySelector('.btn-secondary').style.display = "none";
        }
    </script>
</body>
</html>
